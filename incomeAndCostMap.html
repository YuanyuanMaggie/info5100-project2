<!DOCTYPE html>
<html>
<head>
	<title>Cost and Income</title>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="http://d3js.org/d3.geo.projection.v0.min.js" charset="utf-8"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <style type="text/css">
    	 #IncomeTitle{
        text-align: center;
      }
      	#changeMap{
      		width: 75%;
      		margin: 0 auto;
      	}
    </style>
</head>
<body>
	<div class="row">
  		<div class="col-lg-6">
    		<h2 id="IncomeTitle"></h2>
    		<div id="IncomeMap"></div>
  		</div>
  	<div class="col-lg-6">
      	<h2 id="CostTitle"></h2>
    	<div id="CostMap"></div>
  </div>
  <div id="changeMap">
        <input id="yearChange" type="range" min="2000" max="2014" step="1" 
          oninput="" onchange="changeSlider(this.value)"/>
   </div>
  </div>
 <script type="text/javascript">
  var widthM = 520, heightM = 300;
  var svgM = d3.select('#IncomeMap').append('svg')
              .attr("height",heightM).attr("width",widthM);
  var svgM2 = d3.select('#CostMap').append('svg')
              .attr("height",heightM).attr("width",widthM);
  var projectionM = d3.geo.albersUsa();
  var pathM = d3.geo.path().projection(projectionM);


  var statePathM = svgM.append("g");
  var statePathM2 = svgM2.append("g");

  var houseIncomeScale = d3.scale.linear().domain([26000,77000]).range(["#ffffff","#ff0000"]);
  var costIndexScale = d3.scale.linear().domain([60,170]).range(["#ffffff","#0000ff"]);

  var allData = {};

  var mapStyle = "";
  d3.csv("IncomeAndCostIndex-from2014.csv",function(error,rows){
    if(error){
      console.log(error);
    }
    rows.forEach(function(row){
      var houseIncomeState = {
        "id": row.ID,
        "state":row.State,
        "Income2014":row.Income2014,
        "Income2013":row.Income2013,
        "Income2012":row.Income2012,
        "Income2011":row.Income2011,
        "Income2010":row.Income2010,
        "Income2009":row.Income2009,
        "Income2008":row.Income2008,
        "Income2007":row.Income2007,
        "Income2006":row.Income2006,
        "Income2005":row.Income2005,
        "Income2004":row.Income2004,
        "Income2003":row.Income2003,
        "Income2002":row.Income2002,
        "Income2001":row.Income2001,
        "Income2001":row.Income2000,
        "costIndex2014":row.costIndex2014,
        "costIndex2013":row.costIndex2013,
        "costIndex2012":row.costIndex2012,
        "costIndex2011":row.costIndex2011,
        "costIndex2010":row.costIndex2010,
        "costIndex2009":row.costIndex2009,
        "costIndex2008":row.costIndex2008,
        "costIndex2007":row.costIndex2007,
        "costIndex2006":row.costIndex2006,
        "costIndex2005":row.costIndex2005,
        "costIndex2004":row.costIndex2004,
        "costIndex2003":row.costIndex2003,
        "costIndex2002":row.costIndex2002,
        "costIndex2001":row.costIndex2001
      }
      allData[row.ID]=houseIncomeState;
    })
  })
  //init
  changeMap('Income2014','houseIncome');
//changeMap('costIndex2014','cost');
document.getElementById("yearChange").value = 2014;
  
  function changeMap(infoName,scaleType){
    mapStyle=scaleType;
    d3.json("us.json", function(error, shapes) {
      statesM = topojson.feature(shapes, shapes.objects.states).features;
      stateFifty = [];
      statesM.forEach(function(data){
        if(allData[data.id]){
        stateFifty.push(data);
        };
      })
    
      var scale = scaleType == 'houseIncome'?houseIncomeScale:costIndexScale;
      statePathM.selectAll("path").remove();
      statePathM.selectAll("path").data(stateFifty).enter()
      .append("path")
      .attr("id",function(states){
        var id = "state" + states.id;
        return id;
          })
      .attr("d", pathM)
      .style("fill", function (states) { 
        var states = allData[states.id];
        return scale(parseInt(states[infoName])); })
      .attr("opacity","0.8")
      .attr("transform","scale(0.6)")
      .style("stroke", function(){
        return scaleType == 'houseIncome'?"red":"blue";
      })
      .style("stroke-width", "1")
      .on("mouseover",  function(data){
    
      d3.select(this).style("fill","#fff");
      statePathM.append("rect")
      .attr("width",200)
      .attr("height",50)
      .attr("transform","translate("+d3.mouse(this)+")")
      .style("fill","#fff")
      .style("opacity",0.7)
      .style("stroke","#f00");

      statePathM.append("text").attr("class","detail")
      .attr("transform","translate("+d3.mouse(this)+")")
      .attr("dy","1em")
      .text(information(data,"Income2014"))
      .style("opacity",0.7);
      
      statePathM.append("text").attr("transform","translate("+d3.mouse(this)+")")
      .attr("dy","2em")
      .text(information(data,"costIndex2014"));

      })
    
      .on("mouseout",function (d,i){
      statePathM.selectAll("text").remove();
      statePathM.selectAll("rect").remove();
      d3.select(this).style("fill", function () { 
        var states = allData[d.id];
        return scale(parseInt(states[infoName])); })
      });

    });
    document.getElementById("IncomeTitle").innerHTML=infoName;
  }


  function information(states,text){
    var states = allData[states.id];
    var info = text + " is "+ states[text]+"\n"
    return info;
  } 

  function changeSlider(value){
    if(mapStyle=='houseIncome'){
      var infoName = "Income" + value;
      changeMap(infoName,mapStyle);
      console.log(infoName);
    };
  }
   // var changeRadio = document.changeMap.changeRadio;
   // for(var i = 0;i<changeRadio.length;i++){
   //  changeRadio[i].onclick = function(){
   //    console.log("this.value");
   //  }
   // }
   </script>
</body>
</html>
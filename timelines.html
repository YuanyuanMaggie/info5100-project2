<html>
  <head>
    <title>Cornell Graduates Starting Salaries</title>
    
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"> -->

    <!-- <link rel="stylesheet" href="colorbrewer.css"> -->

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="http://d3js.org/d3.geo.projection.v0.min.js" charset="utf-8"></script>
    <script
        src="https://code.jquery.com/jquery-1.12.3.min.js"
        integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ="
        crossorigin="anonymous">
    </script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script src="colorbrewer.min.js"></script>
    </script>
    <style>
      body { font-family: "Open Sans"; } 

      .row {
        margin-top: 10px;
      }

      .axis {
        font-size: .8em;
      }
      .axis path,
      .axis line {
        fill: none;
        stroke: #ccc;
        stroke-width: .5;
        shape-rendering: crispEdges;
      }
      
      .x.axis .tick text {
        width: 5px;
      }

      .trendline {
        fill: none;
        stroke: steelblue; /* default color */
        stroke-width: 3px;
        stroke-opacity: .5;
      }

      .datapoint {
        fill: #ccc;
      }

      path.slice{
        stroke-width:2px;
      }

      polyline{
        opacity: .3;
        stroke: black;
        stroke-width: 2px;
        fill: none;
      }

      .labels text, .label {
        font-size: .8em;
        font-weight: normal;
      }

      .bold {
        font-size: 2em;
        font-weight: bold;
      }

      .d3-tip {
        line-height: 1;
        font-weight: bold;
        padding: 12px;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        border-radius: 2px;
        }
      .d3-tip:after {
        box-sizing: border-box;
        display: inline;
        font-size: 10px;
        width: 10%;
        height: 50%;
        line-height: 1;
        color: rgba(0, 0, 0, 0.8);
        content: "\25BC";
        position: absolute;
        text-align: center;
        left:50%;
        top:95%;

      }
    </style>

  </head>
  <body>

    <div class="container">
      <div class="row">
        <div class="col-lg-8">
         <h1>Cornell undergraduate tuition and Cornell graduates salary by college</h1>
          <div id="timeline"></div>
        </div>
      </div>
    </div>

    <script>
    salaryTimeline('#timeline', 'salariesByCollege.csv');
    
      function salaryTimeline(el, salaryData) {
        var margin = {top: 30, right: 200, bottom: 30, left: 50},
            width = 780 - margin.left - margin.right,
            height = 520 - margin.top - margin.bottom;

        var parseYear = d3.time.format("%Y").parse;

        var x = d3.time.scale().range([0, width]);
        var y = d3.scale.log().range([height, 0]);

        var color = d3.scale.category10();

        var xAxis = d3.svg.axis().scale(x)
            .orient("bottom").ticks(14);

        var yAxis = d3.svg.axis().scale(y)
            .orient("left").ticks(5).tickFormat(function(d) { return d; });

        var line = d3.svg.line()
          .x(function(d) { return x(d.year); })
          .y(function(d) { return y(d.salary); });

        var chart = d3.select("#timeline")
          .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
          .append("g")
              .attr("transform", 
                    "translate(" + margin.left + "," + margin.top + ")");

        // DATA for salaries by region
        d3.csv(salaryData, function(error, data) {
          color.domain(d3.keys(data[0]).filter(function(key) { 
            if (key !== "Year") {
              return key; 
            }
          }));

          //convert to year format
          data.forEach(function(d) {
            d.Year = parseYear(d.Year);
          });

          // Scale the range of the data
          //TODO: kind of weird i'm building axes here for both charts?
          x.domain(d3.extent(data, function(d) { return d.Year; }));
          y.domain([30000,190000]);

          chart.append("g")            
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(xAxis);
            
          chart.append("g")
              .attr("class", "y axis")
              .call(yAxis);

          var salaryDataMapped = color.domain().map(function(name) {
            return {
              name: name,
              values: data.map(function(d) {
                return {year: d.Year, salary: +d[name]};
              })
            };
          });
          
          
          var trendLine = chart.selectAll(".trend")
              .data(salaryDataMapped)
            .enter().append("g")
              .attr("class", "trend");

          //trend line
          trendLine.append("path")
              .attr("class", "trendline")
              .attr("id",function(d){
                var name = d.name.replace(/ +/g, "");
                return name})
              .attr("d", function(d) { return line(d.values); })
              .style("stroke", function(d) { return color(d.name); })
              ;
          var salaryDataArr = [];
          salaryDataMapped.forEach(function(data){
            var name = data.name;
            data.values.forEach(function(d){
              var salary = d.salary;
              var year = d.year;
              var salaryItem = {
                "name": name,
                "salary":salary,
                "year":year
              };
              salaryDataArr.push(salaryItem);
            });
          })

          var trendCircle = chart.selectAll(".trendCircles")
              .data(salaryDataArr)
            .enter().append("g")
              .attr("class", "trendCircles");

          var tip = d3.tip()
                 .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function(d) {
                    return "<strong>Salary :</strong> <span style='color:red'>$" + d.salary + "</span><br><strong>Region:</strong> <span style='color:red'>" + d.name + "</span>";
                     });

          chart.call(tip);
          //trend circle
          trendCircle.append("circle")
              .attr("class", "trendCircle")
              .attr("cx",function(d){return x(d.year)})
              .attr("cy",function(d){return y(d.salary)})
              .attr("r",3.5)
              .attr("opacity",0.5)
              .style("fill", function(d) { return color(d.name); })
              .on("mouseover",function(d){
                d3.select(this).attr("r",8);
                tip.show(d);
          })
              .on("mouseout",function(d){
                d3.select(this).attr("r",3.5);
                tip.hide(d);
              });
         
          // add legend   
          var legend = chart.append("g")
            .attr("class", "legend")
                //.attr("x", w - 65)
                //.attr("y", 50)
            .attr("height", 100)
            .attr("width", 100)
            .attr('transform', 'translate(-20,50)')    
              
            
            legend.selectAll('rect')
              .data(salaryDataMapped)
              .enter()
              .append("rect")
              .attr("id",function(d){
                var name = d.name.replace(/ +/g, "")+"Rect";
                return name})
              .attr("x", width + margin.left)
              .attr("y", function(d, i){return i * 20;})
              .attr("width", 8)
              .attr("height", 8)
              .style("fill", function(d) { return color(d.name); });
              
            legend.selectAll('text')
              .data(salaryDataMapped)
              .enter()
              .append("text")
              .attr("class", "label")
              .attr("id",function(d){
                var name = d.name.replace(/ +/g, "") + "Label";
                return name})
              .attr("x", width + margin.left + 10)
              .attr("y", function(d, i){ return i * 20 + 8;})
            .style("fill", function(d) { return color(d.name); })
              .text(function(d) { return d.name; })
              .on("mouseover",function(data){
                 d3.select(this).style("font-size","1.5em");
                  var name = "#"+data.name.replace(/ +/g, "")
                  var rect = name + "Rect";
                  d3.select(name).style("stroke-width","8px");
                  d3.select(rect).attr("width",10).attr("height",10);
              })
              .on("mouseout",function(data){
                d3.select(this).style("font-size","0.8em");
                var name = "#"+data.name.replace(/ +/g, "")
                  var rect = name + "Rect";
                  d3.select(name).style("stroke-width","3px");
                  d3.select(rect).attr("width",8).attr("height",8);
              })

        }); 

      }

     
    </script>
  </body>
</html>
